<div class="mainContainer">
  <h2>Backlog</h2>
  <p>Here, the
    <strong>Product Owner</strong> can add new Items to the Backlog. Items can be Epics or User Stories, while only a User Story
    can be estimated. To convert from one to another just hit the
    <strong>edit button</strong> of an existing item.</p>
  The order of the items is also the prioritisation and can be changed via
  <strong>drag and drop</strong>.
  <br><br>

  <div class="row">
    <div class="col-10">
      <table class="table table-hover table-striped">
        <thead>
          <tr>
            <th>Type</th>
            <th>Title</th>
            <th>Description</th>
            <th>Estimation</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody dnd-sortable-container [sortableData]="backlogItems" drag>
          <tr *ngFor="let item of backlogItems; let i = index" class="" dnd-sortable [dragEnabled]="authService.allowedFor(['Product Owner'])" [sortableIndex]="i" (onDropSuccess)="updateOrder()">
            <td>
              <span class="badge badge-info">{{backlogService.getType(item)}}</span>
            </td>
            <th>{{item.title |truncate: 15}}</th>
            <td>{{item.description | truncate: 15}}</td>
            <td>{{item.estimation|| 'Not estimated yet'}}</td>
            <td>
              <span class="badge badge-primary">{{backlogService.getReadableStatus(item.status)}}</span>
            </td>
            <td>
              <div *ngIf="authService.allowedFor(['Product Owner'])">
                <button type="button" class="btn btn-sm fa fa-pencil-square-o " (click)="open(editModal,i)"></button>
                <button type="button" class="btn btn-sm fa fa fa-trash-o " (click)="remove(i)"></button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <p>
      <button *ngIf="authService.allowedFor(['Product Owner'])" class="btn" (click)="open(newModal,0)">New Item</button>
    </p>

    <!-- MODAL EDIT BEGIN -->
    <ng-template #editModal let-c="close" let-d="dismiss">
      <div class="modal-header">
        <h4 class="modal-title">Edit Backlog Item</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="bli-titel">Title</label>
          <input [(ngModel)]="backlogItems[selectedIndex].title" type="text" class="form-control" id="bli-titel" placeholder="Enter Title"
            name="bli-titel" required>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea [(ngModel)]="backlogItems[selectedIndex].description" type="text" class="form-control" id="description" placeholder="Description"
            name="description" required minlength="10"></textarea>
        </div>
        <!-- User Story start -->
        <div *ngIf="selectedIsUserstory()" class="form-group">
          Status: {{backlogService.getReadableStatus(backlogItems[selectedIndex].status)}}
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="editItem(selectedIndex)  ">Save</button>
        <button type="button" class="btn btn-outline-dark" (click)="c('Close click')">Close</button>
      </div>
    </ng-template>
    <!-- MODAL EDIT END -->


    <!-- MODAL NEW BEGIN -->
    <ng-template #newModal let-c="close" let-d="dismiss">
      <div class="modal-header">
        <h4 class="modal-title">New {{newMode}}</h4>
      </div>
      <form ngNativeValidate (ngSubmit)="saveNewItem()" ngNat #f="ngForm">

        <div class="modal-body">
          <!-- Datatoggles not working, design screwed up -->
          <div class="btn-group">
            <label class="btn btn-primary">
              <input type="radio" value="User Story" name="options" id="options1" autocomplete="off" [(ngModel)]="newMode" checked> User Story
            </label>
            <label class="btn btn-primary">
              <input type="radio" value="Epic" name="options" id="options2" autocomplete="off" [(ngModel)]="newMode"> Epic
            </label>
          </div>

          <div class="form-group">
            <label for="bli-titel">Title</label>
            <input [(ngModel)]="newBacklogItem.title" type="text" class="form-control" id="bli-titel" placeholder="Enter Title" name="bli-titel"
              required>
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea [(ngModel)]="newBacklogItem.description" type="text" class="form-control" id="description" placeholder="Description"
              name="description" required minlength="10"></textarea>
          </div>
        </div>


        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-outline-dark" (click)="c('Close click')">Close</button>
        </div>
      </form>
    </ng-template>

  </div>
</div>